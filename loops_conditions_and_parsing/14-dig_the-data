#!/usr/bin/env bash
#w
awk '
{
  # Extract IPv4 or IPv6 address at start of line (IPv6 has colons, IPv4 dots)
  if (match($0, /^(([0-9]{1,3}\.){3}[0-9]{1,3}|([0-9a-fA-F:]+)) /, ip_match)) {
    ip = ip_match[1]
  } else {
    next
  }
  
  # Extract status code: 3-digit number after quoted request ("...")
  if (match($0, /"[^"]*" ([0-9]{3})/, status_match)) {
    status = status_match[1]
  } else {
    next
  }
  
  # Print only if both IP and status code found
  if (ip != "" && status != "") {
    print ip, status
  }
}
' apache-access.log | sort | uniq -c | sort -rn | awk '{print $1, $2, $3}'

